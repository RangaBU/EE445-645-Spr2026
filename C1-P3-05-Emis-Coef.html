<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Photon Emission Visualization</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: #000;
            font-family: Arial, sans-serif;
        }
        canvas {
            display: block;
        }
        #info {
            position: absolute;
            top: 20px;
            left: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
            line-height: 1.8;
            max-width: 380px;
        }
        .formula {
            font-family: 'Times New Roman', serif;
            font-style: italic;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 4px;
            font-size: 13px;
        }
        #legend {
            position: absolute;
            top: 20px;
            right: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px;
            border-radius: 8px;
            font-size: 12px;
            line-height: 1.8;
        }
        .color-box {
            display: inline-block;
            width: 15px;
            height: 15px;
            margin-right: 5px;
            vertical-align: middle;
            border: 1px solid #666;
        }
        #controls {
            position: absolute;
            bottom: 20px;
            left: 20px;
            color: #fff;
            background: rgba(0, 0, 0, 0.85);
            padding: 15px;
            border-radius: 8px;
            font-size: 13px;
        }
        button {
            background: #4a9eff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 4px;
        }
        button:hover {
            background: #3a8eef;
        }
        .slider-container {
            margin: 10px 0;
        }
        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 12px;
        }
        input[type="range"] {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            background: #444;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #4a9eff;
            cursor: pointer;
        }
        input[type="range"]::-moz-range-thumb {
            width: 14px;
            height: 14px;
            border-radius: 50%;
            background: #4a9eff;
            cursor: pointer;
            border: none;
        }
        .value-display {
            color: #4a9eff;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div id="info">
        <strong>Photon Emission Visualization</strong>
        <div class="formula">
            dN<sub>E</sub> = q(r‚Éó, ŒΩ', Œ©', t) dr‚Éó dŒΩ' dŒ©' dt
        </div>
        <strong>Emission Coefficient q:</strong><br>
        Units: # m<sup>-3</sup> Hz<sup>-1</sup> sr<sup>-1</sup> s<sup>-1</sup><br>
        <br>
        <strong>Parameters:</strong><br>
        ‚Ä¢ <strong>r‚Éó</strong>: Position (volume element)<br>
        ‚Ä¢ <strong>ŒΩ'</strong>: Emission frequency<br>
        ‚Ä¢ <strong>Œ©'</strong>: Emission direction<br>
        ‚Ä¢ <strong>t</strong>: Time<br>
        <br>
        <span id="stats">Emitted: 0 | Active: 0</span>
    </div>
    
    <div id="legend">
        <strong>Frequency/Color:</strong><br>
        <span class="color-box" style="background: #ff0000;"></span> Low ŒΩ' (Red)<br>
        <span class="color-box" style="background: #ff8800;"></span> ‚Üì<br>
        <span class="color-box" style="background: #ffff00;"></span> Medium ŒΩ'<br>
        <span class="color-box" style="background: #00ff00;"></span> ‚Üì<br>
        <span class="color-box" style="background: #0088ff;"></span> High ŒΩ' (Blue)<br>
        <br>
        <strong>Visual Elements:</strong><br>
        üü¶ Blue cube: Volume element dr‚Éó<br>
        ‚ö™ Spheres: Emitted photons<br>
        üìä Color: Frequency ŒΩ'<br>
        ‚û°Ô∏è Direction: Random Œ©'
    </div>
    
    <div id="controls">
        <div class="slider-container">
            <div class="slider-label">
                <span>Emission Rate</span>
                <span class="value-display" id="rateValue">50</span>
            </div>
            <input type="range" id="rateSlider" min="10" max="100" step="10" value="50">
        </div>
        <button onclick="toggleAnimation()">Pause/Resume</button>
        <button onclick="resetSimulation()">Reset</button>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let volumeElement;
        let photons = [];
        let animationRunning = true;
        let emissionRate = 50;
        let totalEmitted = 0;
        let frameCount = 0;

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x0a0a15);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(6, 5, 6);
            camera.lookAt(0, 0, 0);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Lighting
            const ambientLight = new THREE.AmbientLight(0x404040, 1.5);
            scene.add(ambientLight);

            const pointLight1 = new THREE.PointLight(0xffffff, 1.0);
            pointLight1.position.set(10, 10, 10);
            scene.add(pointLight1);

            const pointLight2 = new THREE.PointLight(0x6699ff, 0.5);
            pointLight2.position.set(-10, -10, -10);
            scene.add(pointLight2);

            // Create coordinate axes
            createAxes();

            // Create volume element (emitting region)
            createVolumeElement();

            // Event listeners
            document.getElementById('rateSlider').addEventListener('input', function(e) {
                emissionRate = parseInt(e.target.value);
                document.getElementById('rateValue').textContent = emissionRate;
            });

            window.addEventListener('resize', onWindowResize, false);
            
            // Mouse controls
            let mouseDown = false;
            let mouseX = 0, mouseY = 0;
            
            renderer.domElement.addEventListener('mousedown', (e) => {
                mouseDown = true;
                mouseX = e.clientX;
                mouseY = e.clientY;
            });
            
            renderer.domElement.addEventListener('mouseup', () => {
                mouseDown = false;
            });
            
            renderer.domElement.addEventListener('mousemove', (e) => {
                if (mouseDown) {
                    const deltaX = e.clientX - mouseX;
                    const deltaY = e.clientY - mouseY;
                    
                    camera.position.applyAxisAngle(new THREE.Vector3(0, 1, 0), deltaX * 0.005);
                    
                    mouseX = e.clientX;
                    mouseY = e.clientY;
                    
                    camera.lookAt(0, 0, 0);
                }
            });
        }

        function createAxes() {
            const axisLength = 5;
            const axisHelper = new THREE.AxesHelper(axisLength);
            scene.add(axisHelper);
            
            // Add axis labels
            createAxisLabel('X', new THREE.Vector3(axisLength + 0.3, 0, 0), 0xff0000);
            createAxisLabel('Y', new THREE.Vector3(0, 0, axisLength + 0.3), 0x0000ff);
            createAxisLabel('Z', new THREE.Vector3(0, axisLength + 0.3, 0), 0x00ff00);
        }

        function createAxisLabel(text, position, color) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 128;
            canvas.height = 128;
            
            context.fillStyle = '#' + color.toString(16).padStart(6, '0');
            context.font = 'Bold 80px Arial';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillText(text, 64, 64);
            
            const texture = new THREE.CanvasTexture(canvas);
            const spriteMaterial = new THREE.SpriteMaterial({ map: texture });
            const sprite = new THREE.Sprite(spriteMaterial);
            sprite.position.copy(position);
            sprite.scale.set(0.5, 0.5, 1);
            scene.add(sprite);
        }

        function createVolumeElement() {
            // Create a semi-transparent cube representing the volume element dr‚Éó
            const geometry = new THREE.BoxGeometry(0.8, 0.8, 0.8);
            const edges = new THREE.EdgesGeometry(geometry);
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0x4488ff, linewidth: 2 });
            const wireframe = new THREE.LineSegments(edges, lineMaterial);
            
            const material = new THREE.MeshPhongMaterial({ 
                color: 0x4488ff,
                transparent: true,
                opacity: 0.2,
                side: THREE.DoubleSide
            });
            const cube = new THREE.Mesh(geometry, material);
            
            const group = new THREE.Group();
            group.add(cube);
            group.add(wireframe);
            group.position.set(0, 0, 0);
            
            scene.add(group);
            volumeElement = group;
        }

        function frequencyToColor(freq) {
            // freq ranges from 0 (low) to 1 (high)
            if (freq < 0.25) {
                // Red to Orange
                const t = freq / 0.25;
                return new THREE.Color().setRGB(1, t * 0.5, 0);
            } else if (freq < 0.5) {
                // Orange to Yellow
                const t = (freq - 0.25) / 0.25;
                return new THREE.Color().setRGB(1, 0.5 + t * 0.5, 0);
            } else if (freq < 0.75) {
                // Yellow to Green
                const t = (freq - 0.5) / 0.25;
                return new THREE.Color().setRGB(1 - t, 1, 0);
            } else {
                // Green to Blue
                const t = (freq - 0.75) / 0.25;
                return new THREE.Color().setRGB(0, 1 - t * 0.5, t);
            }
        }

        function emitPhoton() {
            // Random frequency ŒΩ'
            const frequency = Math.random();
            const color = frequencyToColor(frequency);
            
            // Create photon
            const photonGeometry = new THREE.SphereGeometry(0.08, 8, 8);
            const photonMaterial = new THREE.MeshBasicMaterial({ 
                color: color,
                transparent: true,
                opacity: 0.9
            });
            const photon = new THREE.Mesh(photonGeometry, photonMaterial);
            
            // Random position within volume element
            photon.position.x = (Math.random() - 0.5) * 0.6;
            photon.position.y = (Math.random() - 0.5) * 0.6;
            photon.position.z = (Math.random() - 0.5) * 0.6;
            
            // Random direction Œ©' (isotropic emission)
            const theta = Math.acos(2 * Math.random() - 1);
            const phi = Math.random() * 2 * Math.PI;
            
            const direction = new THREE.Vector3(
                Math.sin(theta) * Math.cos(phi),
                Math.cos(theta),
                Math.sin(theta) * Math.sin(phi)
            ).normalize();
            
            const speed = 0.04;
            
            // Create trail
            const trailGeometry = new THREE.BufferGeometry();
            const trailMaterial = new THREE.LineBasicMaterial({ 
                color: color,
                transparent: true,
                opacity: 0.4
            });
            const trail = new THREE.Line(trailGeometry, trailMaterial);
            
            photon.userData = {
                velocity: direction.multiplyScalar(speed),
                trail: trail,
                trailPositions: [],
                frequency: frequency,
                age: 0
            };
            
            scene.add(photon);
            scene.add(trail);
            photons.push(photon);
            totalEmitted++;
        }

        function updatePhotons() {
            for (let i = photons.length - 1; i >= 0; i--) {
                const photon = photons[i];
                
                // Move photon
                photon.position.add(photon.userData.velocity);
                photon.userData.age++;
                
                // Update trail
                photon.userData.trailPositions.push(photon.position.clone());
                if (photon.userData.trailPositions.length > 20) {
                    photon.userData.trailPositions.shift();
                }
                
                const positions = new Float32Array(photon.userData.trailPositions.length * 3);
                for (let j = 0; j < photon.userData.trailPositions.length; j++) {
                    positions[j * 3] = photon.userData.trailPositions[j].x;
                    positions[j * 3 + 1] = photon.userData.trailPositions[j].y;
                    positions[j * 3 + 2] = photon.userData.trailPositions[j].z;
                }
                photon.userData.trail.geometry.setAttribute('position', 
                    new THREE.BufferAttribute(positions, 3));
                
                // Remove photon if it's too far or too old
                const distance = photon.position.length();
                if (distance > 10 || photon.userData.age > 500) {
                    scene.remove(photon);
                    scene.remove(photon.userData.trail);
                    photons.splice(i, 1);
                }
            }
        }

        function updateStats() {
            document.getElementById('stats').textContent = 
                `Emitted: ${totalEmitted} | Active: ${photons.length}`;
        }

        function animate() {
            requestAnimationFrame(animate);
            
            if (animationRunning) {
                frameCount++;
                
                // Emit photons based on emission rate
                // Higher rate = more frequent emission
                const emitProbability = emissionRate / 100;
                if (Math.random() < emitProbability) {
                    const numToEmit = Math.floor(Math.random() * 3) + 1;
                    for (let i = 0; i < numToEmit; i++) {
                        emitPhoton();
                    }
                }
                
                updatePhotons();
                updateStats();
                
                // Gentle rotation
                const time = Date.now() * 0.0001;
                camera.position.x = Math.cos(time) * 8;
                camera.position.z = Math.sin(time) * 8;
                camera.lookAt(0, 0, 0);
            }
            
            renderer.render(scene, camera);
        }

        function toggleAnimation() {
            animationRunning = !animationRunning;
        }

        function resetSimulation() {
            photons.forEach(photon => {
                scene.remove(photon);
                scene.remove(photon.userData.trail);
            });
            photons = [];
            totalEmitted = 0;
            updateStats();
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        init();
        animate();
    </script>
</body>
</html>